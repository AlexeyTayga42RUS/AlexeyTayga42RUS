ТОП 10 КНИГ

CREATE VIEW TOP_10_BOOKS AS
WITH TOP_CARD_OF_PM AS (
    SELECT
        CARD_OF_PM.TITLE AS TITLE_CARD_OF_PM,
        COUNT(JUP.ID_CARD_OF_PM) AS COUNT_CARD_OF_PM,
        RANK() OVER (ORDER BY COUNT(JUP.ID_CARD_OF_PM) DESC) AS TOP
    FROM CARD_OF_PM
    JOIN JOURNAL_OF_USAGE_PM JUP 
    ON CARD_OF_PM.ID_CARD_OF_PM = JUP.ID_CARD_OF_PM
    GROUP BY CARD_OF_PM.TITLE
)
SELECT TITLE_CARD_OF_PM, COUNT_CARD_OF_PM, TOP
FROM TOP_CARD_OF_PM
WHERE TOP <= 10;

ЗАПРОС К VIEW

SELECT TITLE_CARD_OF_PM, COUNT_CARD_OF_PM 
FROM TOP_10_BOOKS
WHERE TOP <= 10;



ТОП 10 ЧИТАТЕЛЕЙ

CREATE VIEW TOP10_CLIENT AS
WITH TOP_CLIENT_CARD AS (
    SELECT
        CL.LAST_NAME || ' ' || CL.FIRST_NAME || ' ' || CL.PATRONYMIC AS Client_FullName,
        COUNT(JUP.ID_CLIENT) AS COUNT_ID_CLIENT,RANK() OVER (ORDER BY COUNT(JUP.ID_CLIENT) DESC) AS TOP
    FROM CLIENT_CARD CL
        JOIN JOURNAL_OF_USAGE_PM JUP
        	ON CL.ID_CLIENT = JUP.ID_CLIENT
	WHERE JUP.END_DATE BETWEEN TO_DATE('01.01.2022','DD.MM.YYYY') AND TO_DATE('02.02.2023','DD.MM.YYYY')
    GROUP BY CL.LAST_NAME || ' ' || CL.FIRST_NAME || ' ' || CL.PATRONYMIC)
SELECT Client_FullName, COUNT_ID_CLIENT, TOP
FROM TOP_CLIENT_CARD
WHERE TOP <= 10;

ЗАПРОС К VIEW

SELECT Client_FullName, COUNT_ID_CLIENT, TOP
FROM TOP10_CLIENT
WHERE TOP <= 10;







